## webSafe
### xss
> Cross-Site Scripting(跨站脚本攻击) 简称XSS, 是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本,使之在用户的浏览器上运行。利用这些恶意脚本,攻击者可以获取用户敏感信息比如Cookie/sessionID等,进而危害数据安全

1. 储存型攻击: 通常发生在微波论坛等用户发帖、提交文章评论等地方
- 将恶意代码提交到数据库
- 数据库将其保存
- 他用户查看帖子或者评论
- 服务端返回恶意代码并被拼接到客户端页面
- 恶意代码可能通过自执行或者用户点击执行来弹出广告或者获取用户cookie等个人隐私并上报到攻击者数据库

2. 反射性攻击: 通常发生在一些带有诱导性的链接的按钮邮件等
- 攻击者在一些链接的参数中加入恶意代码并诱导用户点击
- 用户通过点击将请求参数传入服务端
- 服务端获取参数并拼接返回给客户端
- 客户端执行恶意代码冒充用户进行权限操作或者盗取用户的cookie等个人隐私并上报攻击者数据库

3. DOM型攻击
- 攻击者构造出特殊的URL,其中包括恶意代码
- 用户打开带有恶意代码的URL
- 用户浏览器接收到响应后解析执行,前端JavaScript取出URL中的恶意代码并执行
- 恶意代码窃取用户数据并发送到攻击者的网站,或者冒充用户的行为,调用网站接口执行攻击者指定的操作

> DOM型和反射型都是通过诱导用户点击链接执行,并且都是临时型的,但是反射型属于服务端安全漏洞而DOM型属于客户端安全漏洞

4. 如何防范xss攻击
- 客户端对用户输入的内容进行安全符转义,服务端对上交内容进行安全转义
- 服务端渲染开启模板引擎自带的HTML转义功能
- 避免内联事件,尽量不要使用onload="onload('{{data}}')"/onClick="go({{action}})"这种拼接内联事件的写法。通过addEventListener事件绑定会更安全
- 避免拼接HTML,前端采用拼接HTML方法比较危险,如果框架允许,使用createElement/setAttribute之类的方法实现。或者采用比较成熟的框架
- 在插入位置为DOM属性/链接等位置时需要保持警惕
- 通过csp、输入长度配置、接口安全措施等方式增加攻击的难度
- 主动监测和发现,可使用XSS攻击字符串和自动扫描工具寻找潜在的XSS漏洞
- 尽量避免第三方跨域提交到服务端
- HTTP-only cookie:禁止JavaScript读取Cookie
- 验证码: 防止脚本冒充用户提交危险操作
### csrf
> CSRF(Corss-site request forgery) 跨站请求伪造: 攻击者诱导受害者进入第三方网站,在第三方网站中,向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证,绕过后台的用户验证,达到冒充用户对被攻击的执行某项操作的目的

1. 主动型攻击
- 受害者访问a.com并在浏览器留下a.com的登录态
- 攻击者诱导受害者进入第三方网站b.com
- 三方网站b.com值有访问a.com接口的恶意代码
- 受害者点击b.com时,b.com带着a.com登录凭证冒充受害者执行对a.com的恶意操作

2. 被动型攻击
- 攻击者在a.com发布带有恶意链接的帖子或者评论(提交对a.com带有增删改查的诱导性img/form/a标签)
- 当其他拥有登录态的受害者点击该评论的恶意链接冒用受害者登录凭证发起攻击

3. 如何防御CSRF攻击
- 禁止第三方网站获取cookie,比如设置chrome的samesite(弊端是兼容性不是很好)
- 服务端通过Refer Header和Origin Header 来进行同源认证 弊端是攻击者可以隐藏rerfer`<img src="xx" refererpolicy="no-referer" />`/重定向可能丢失头部/https跳转到http会丢失所有refer
- 通过token来鉴别,三方跨站请求并不能获取到头部的token。三方请求不能获取token 弊端是对服务器压力较大,并且对于ajax、fetch、form等请求还要一个个加token
- 通过双重cookie来认证,在每个请求参数都附加`scrfCookie='随机数'`防御参数,并在cookie中混入防御参数值,服务端将请求头部cookie参数和cookie参数和进度对比 弊端是前后端分离的代码可能不同源
### dos
> DOS攻击通过在网络的各个环节进行攻击,使得整个流程跑不起来,达到瘫痪服务器的目的。最常见的就是发送大量请求导致服务器过载

1. 防范措施
- 扩容服务器
- 进行实时监控,封禁恶意密集请求ip
- 增加接口认证,对于敏感接口,对单个ip进行访问限制
- 使用cdn缓存
### http劫持
1. DNS劫持
> DNS劫持又称为域名劫持,是指在劫持的网络范围内拦截域名解析的请求,分析请求的域名,把审核以外的请求放行,否则返回假的IP地址或者什么都不做使请求失去响应,其效果就是对特定的网络不能访问或访问的是假网址,本质就是对DNS解析服务器做手脚,或者使用伪造的DNS域名解析器

解决方法: DNS劫持过程是通过攻击运营商的解析的服务器来达到目的。我们可以不用运营商的DNS解析而使用自己的解析服务器或者是提前在自己的App中将解析好的域名以及IP发出去就可以绕过DNS

2. 内容劫持

> 有些运营商为了加快用户的访问速度增加了缓存池,请求会先请求缓存池,如果有人对缓存池进行了修改那就我们就收到错误的数据